---
# tasks file for syndesis
-
  name: Create syndesis custom resource definition
  shell: oc create -f {{ syndesis_crd_url }} --namespace {{ syndesis_namespace }}

-
  name: Deploy syndesis operator
  shell: oc create -f {{ syndesis_operator_url }} --namespace {{ syndesis_namespace }}

-
  name: Verify syndesis operator deployment succeeded
  shell: sleep 5; oc get pods --namespace {{ syndesis_namespace }}  |  grep  "deploy"
  register: result
  until: not result.stdout
  retries: 50
  delay: 10
  failed_when: result.stdout
  changed_when: False

-
  name: Deploy syndesis
  shell: oc create -f {{ syndesis_url }} --namespace {{ syndesis_namespace }}

-
  name: Verify syndesis deployment succeeded
  shell: sleep 5; oc get pods --namespace {{ syndesis_namespace }}  |  grep  "deploy"
  register: result
  until: not result.stdout
  retries: 50
  delay: 10
  failed_when: result.stdout
  changed_when: False
