---
- name: "Register CRDs for Integreatly Operator"
  shell: "oc apply -f {{ item }}"
  with_items: "{{ integreatly_operator_crds }}"

- include_role:
    name: namespace
    tasks_from: create
  vars:
    name: "{{ integreatly_operator_ns_name }}"
    is_service: true

- name: "Deploy the Integreatly Operator"
  shell: "oc process -f {{ integreatly_operator_template }} -p NAMESPACE={{ integreatly_operator_ns_name }} -p INSTALLATION_CONFIG_MAP={{Â integreatly_operator_configmap }} | oc apply --namespace {{ integreatly_operator_ns_name }}  -f -"

- template:
    src: integreatly-customresource.yml.j2
    dest: /tmp/integreatly-customresource.yml

- name: Create Installation custom resource in {{ integreatly_operator_ns_name }}
  shell: oc apply -f /tmp/integreatly-customresource.yml -n {{ integreatly_operator_ns_name }}

- include_tasks: ./set_config.yml